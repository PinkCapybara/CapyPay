import { SidebarItem } from "../../components/SidebarItem";
import { getServerSession } from "next-auth";
import { authOptions } from "../lib/auth";
import { redirect } from "next/navigation";
import { fetchBalance, fetchOffRampTransactions, fetchOnRampTransactions, fetchP2PTransfers } from "../lib/dataFetching";
import { JotaiProvider } from "./providers";

export default async function Layout({
  children,
}: {
  children: React.ReactNode;
}){
  const session = await getServerSession(authOptions);
  if(!session?.user) {
    redirect("/api/auth/signin");
  }

  const balance = await fetchBalance();
  const onRampTransactions = await fetchOnRampTransactions();
  const offRampTransactions = await fetchOffRampTransactions(); 
  const p2pTransfers = await fetchP2PTransfers();

  return (
    <JotaiProvider initialBalance={balance} onRampTxns={onRampTransactions} offRampTxns={offRampTransactions} p2pTransfers={p2pTransfers}>
    <div className="flex">
        <div className="w-72 border-r border-slate-300 min-h-screen mr-4 pt-28">
            <div>
                <SidebarItem href={"/dashboard"} icon={<HomeIcon />} title="Home" />
                <SidebarItem href={"/p2p"} icon={<P2PTransferIcon />} title="P2P Transfer" />
                <SidebarItem href={"/deposit"} icon={<DepositIcon />} title="Deposit" />
                <SidebarItem href={"/transactions"} icon={<TransactionsIcon />} title="Transactions" />             
                <SidebarItem href={"/withdraw"} icon={<WithdrawIcom />} title="Withdraw" />
            </div>
        </div>
            {children}
    </div>
   </JotaiProvider>
  );
}

function HomeIcon() {
    return <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
    <path strokeLinecap="round" strokeLinejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
  </svg>
}
function P2PTransferIcon() {
    return <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
    <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
  </svg>
}

function TransactionsIcon() {
    return <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
  </svg>
  
}

function DepositIcon(){
  return <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 -8 42 42"
  strokeWidth="1"
  stroke="currentColor"
  className="w-7 h-6"
>
  <g transform="scale(24/42)"> 
    <g id="ui-gambling-website-lined-icnos-casinoshunter" transform="translate(-729.000000, -547.000000)" fill="currentColor" fillRule="nonzero">
    <g id="square-filled" transform="translate(50.000000, 120.000000)">
    <path
      d="M708.440202,427 C709.918327,427 711.116584,428.2042 711.116584,429.689655 L711.116,430.538 L711.265312,430.538718 L711.265512,430.256336 C711.265512,429.266032 712.06435,428.463232 713.049767,428.463232 C713.393444,428.463232 713.729808,428.56298 714.018428,428.750486 L720.184194,432.756148 C721.011748,433.293778 721.248928,434.403805 720.713951,435.235463 C720.576846,435.448602 720.396281,435.630063 720.184194,435.767848 L714.018428,439.77351 C713.190874,440.31114 712.086325,440.072783 711.551348,439.241125 C711.364768,438.951073 711.265512,438.613041 711.265512,438.268298 L711.265312,437.984585 L711.116,437.984 L711.118297,442.217325 C713.355457,446.366261 711.377052,452.694044 705.182253,452.989315 L704.900763,452.9985 C697.961649,453.136281 695.067302,443.743322 700.748655,439.965974 C701.339522,439.603285 701.054367,439.761985 701.441164,439.557934 C701.818537,439.358856 701.358338,439.592982 702.219834,439.169233 C703.049023,438.83792 703.953651,438.655172 704.900552,438.655172 C706.731861,438.687553 708.209331,439.236706 709.332941,440.102922 L709.332,437.984 L701.303183,437.984959 C700.317767,437.984959 699.518929,437.182159 699.518929,436.191856 L699.518929,432.33214 C699.518929,431.341836 700.317767,430.539036 701.303155,430.539036 L709.332,430.538 L709.332329,429.689655 C709.332329,429.194503 708.93291,428.793103 708.440202,428.793103 L681.676382,428.793103 C681.183674,428.793103 680.784255,429.194503 680.784255,429.689655 L680.784255,445.827586 C680.784255,446.322738 681.183674,446.724138 681.676382,446.724138 L697.789938,446.724514 C697.867707,447.350994 698.025872,447.952379 698.253732,448.517913 L681.676382,448.517241 C680.198257,448.517241 679,447.313042 679,445.827586 L679,429.689655 C679,428.2042 680.198257,427 681.676382,427 L708.440202,427 Z M702.66583,449.011445 L701.432601,450.237808 C702.193196,450.830391 703.110248,451.232688 704.110898,451.372876 L704.110898,451.372876 L704.110898,449.63261 C703.582461,449.524353 703.093244,449.30894 702.66583,449.011445 L702.66583,449.011445 Z M707.135221,449.011497 C706.707808,449.30894 706.218591,449.524353 705.690206,449.63261 L705.690206,449.63261 L705.690206,451.372876 C706.690804,451.232688 707.607908,450.830391 708.368451,450.237808 L708.368451,450.237808 Z M710.49678,446.46402 L708.754592,446.46402 C708.66973,446.973002 708.485372,447.448744 708.22168,447.87088 L708.22168,447.87088 L709.464123,449.106352 C710.018039,448.346255 710.384754,447.44309 710.49678,446.46402 L710.49678,446.46402 Z M701.046512,446.46402 L699.304324,446.46402 C699.41635,447.44309 699.783066,448.346255 700.336982,449.1063 L700.336982,449.1063 L701.579424,447.870828 C701.315679,447.448691 701.131321,446.97295 701.046512,446.46402 L701.046512,446.46402 Z M704.900657,443.511838 C701.841379,443.565914 701.840905,448.087393 704.900552,448.14194 C707.959726,448.087812 707.960199,443.566385 704.900657,443.511838 Z M700.4648,442.378392 C699.898566,443.09703 699.505107,443.95617 699.346281,444.893571 L699.346281,444.893571 L701.10779,444.893571 C701.224553,444.424687 701.427179,443.989464 701.69803,443.604704 L701.69803,443.604704 Z M709.336304,442.378392 L708.103074,443.604704 C708.373926,443.989464 708.576604,444.424687 708.693315,444.893571 L708.693315,444.893571 L710.45477,444.893571 C710.295997,443.95617 709.902539,443.09703 709.336304,442.378392 L709.336304,442.378392 Z M688.481441,442.241379 C688.938504,442.241379 689.309027,442.611902 689.309027,443.068966 C689.309027,443.526029 688.938504,443.896552 688.481441,443.896552 L683.396096,443.896552 C682.939032,443.896552 682.568509,443.526029 682.568509,443.068966 C682.568509,442.611902 682.939032,442.241379 683.396096,442.241379 L688.481441,442.241379 Z M696.114086,442.241379 C696.571149,442.241379 696.941672,442.611902 696.941672,443.068966 C696.941672,443.526029 696.571149,443.896552 696.114086,443.896552 L691.02874,443.896552 C690.571677,443.896552 690.201154,443.526029 690.201154,443.068966 C690.201154,442.611902 690.571677,442.241379 691.02874,442.241379 L696.114086,442.241379 Z M704.110898,440.280901 C703.183686,440.41083 702.328279,440.766013 701.60264,441.288867 L701.60264,441.288867 L702.845082,442.52434 C703.228222,442.287673 703.655004,442.114557 704.110898,442.021168 L704.110898,442.021168 Z M705.690206,440.280953 L705.690206,442.02122 C706.1461,442.114609 706.572882,442.287725 706.956022,442.524392 L706.956022,442.524392 L708.198465,441.288972 C707.472825,440.766013 706.617419,440.410882 705.690206,440.280953 L705.690206,440.280953 Z M713.049767,430.256336 L713.048297,432.331765 L701.303167,432.33214 L701.303167,436.191856 L713.048297,436.191415 L713.049767,438.26766 L719.215532,434.261998 L713.049767,430.256336 Z M687.029146,430.586207 C688.014563,430.586207 688.813401,431.389007 688.813401,432.37931 C688.813401,433.369614 688.014563,434.172414 687.029146,434.172414 C686.495948,434.172414 686.017376,433.937372 685.690423,433.564763 C685.364534,433.937372 684.885962,434.172414 684.352764,434.172414 C683.367347,434.172414 682.568509,433.369614 682.568509,432.37931 C682.568509,431.389007 683.367347,430.586207 684.352764,430.586207 C684.885962,430.586207 685.364534,430.821249 685.691487,431.193857 C686.017376,430.821249 686.495948,430.586207 687.029146,430.586207 Z" 
      strokeLinecap="round"
      strokeLinejoin="round"
    />
    </g>
    </g>
  </g>
</svg>
}

function WithdrawIcom(){
 return <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 -8 42 42"
  strokeWidth="1"
  stroke="currentColor"
  className="w-7 h-6"
>
  <g transform="scale(24/42)"> 
    <g id="ui-gambling-website-lined-icnos-casinoshunter" transform="translate(-860.000000, -547.000000)" fill="currentColor" fillRule="nonzero">
    <g id="square-filled" transform="translate(50.000000, 120.000000)">
    <path
      d="M839.440202,427 C840.918327,427 842.116584,428.2042 842.116584,429.689655 L842.116,430.538 L848.215774,430.539036 C849.151893,430.539036 849.91965,431.263563 849.994085,432.185078 L850,432.33214 L850,436.191856 C850,437.182159 849.201162,437.984959 848.215745,437.984959 L848.215745,437.984959 L842.116,437.984 L842.118297,442.217325 C844.355457,446.366261 842.377052,452.694044 836.182253,452.989315 L835.900763,452.9985 C828.961649,453.136281 826.067302,443.743322 831.748655,439.965974 C832.339522,439.603285 832.054367,439.761985 832.441164,439.557934 C832.818537,439.358856 832.358338,439.592982 833.219834,439.169233 C833.511128,439.052843 833.811732,438.954787 834.120208,438.876549 L829.334735,435.767848 C829.122648,435.630063 828.942082,435.448602 828.804977,435.235463 C828.27,434.403805 828.507181,433.293778 829.334735,432.756148 L829.334735,432.756148 L835.434,428.793 L812.676382,428.793103 C812.183674,428.793103 811.784255,429.194503 811.784255,429.689655 L811.784255,445.827586 C811.784255,446.322738 812.183674,446.724138 812.676382,446.724138 L828.789938,446.724514 C828.867707,447.350994 829.025872,447.952379 829.253732,448.517913 L812.676382,448.517241 C811.198257,448.517241 810,447.313042 810,445.827586 L810,429.689655 C810,428.2042 811.198257,427 812.676382,427 L839.440202,427 Z M833.66583,449.011445 L832.432601,450.237808 C833.193196,450.830391 834.110248,451.232688 835.110898,451.372876 L835.110898,451.372876 L835.110898,449.63261 C834.582461,449.524353 834.093244,449.30894 833.66583,449.011445 L833.66583,449.011445 Z M838.135221,449.011497 C837.707808,449.30894 837.218591,449.524353 836.690206,449.63261 L836.690206,449.63261 L836.690206,451.372876 C837.690804,451.232688 838.607908,450.830391 839.368451,450.237808 L839.368451,450.237808 Z M841.49678,446.46402 L839.754592,446.46402 C839.66973,446.973002 839.485372,447.448744 839.22168,447.87088 L839.22168,447.87088 L840.464123,449.106352 C841.018039,448.346255 841.384754,447.44309 841.49678,446.46402 L841.49678,446.46402 Z M832.046512,446.46402 L830.304324,446.46402 C830.41635,447.44309 830.783066,448.346255 831.336982,449.1063 L831.336982,449.1063 L832.579424,447.870828 C832.315679,447.448691 832.131321,446.97295 832.046512,446.46402 L832.046512,446.46402 Z M835.900657,443.511838 C832.841379,443.565914 832.840905,448.087393 835.900552,448.14194 C838.959726,448.087812 838.960199,443.566385 835.900657,443.511838 Z M831.4648,442.378392 C830.898566,443.09703 830.505107,443.95617 830.346281,444.893571 L830.346281,444.893571 L832.10779,444.893571 C832.224553,444.424687 832.427179,443.989464 832.69803,443.604704 L832.69803,443.604704 Z M840.336304,442.378392 L839.103074,443.604704 C839.373926,443.989464 839.576604,444.424687 839.693315,444.893571 L839.693315,444.893571 L841.45477,444.893571 C841.295997,443.95617 840.902539,443.09703 840.336304,442.378392 L840.336304,442.378392 Z M819.481441,442.241379 C819.938504,442.241379 820.309027,442.611902 820.309027,443.068966 C820.309027,443.526029 819.938504,443.896552 819.481441,443.896552 L814.396096,443.896552 C813.939032,443.896552 813.568509,443.526029 813.568509,443.068966 C813.568509,442.611902 813.939032,442.241379 814.396096,442.241379 L819.481441,442.241379 Z M827.114086,442.241379 C827.571149,442.241379 827.941672,442.611902 827.941672,443.068966 C827.941672,443.526029 827.571149,443.896552 827.114086,443.896552 L822.02874,443.896552 C821.571677,443.896552 821.201154,443.526029 821.201154,443.068966 C821.201154,442.611902 821.571677,442.241379 822.02874,442.241379 L827.114086,442.241379 Z M835.110898,440.280901 C834.183686,440.41083 833.328279,440.766013 832.60264,441.288867 L832.60264,441.288867 L833.845082,442.52434 C834.228222,442.287673 834.655004,442.114557 835.110898,442.021168 L835.110898,442.021168 Z M836.690206,440.280953 L836.690206,442.02122 C837.1461,442.114609 837.572882,442.287725 837.956022,442.524392 L837.956022,442.524392 L839.198465,441.288972 C838.472825,440.766013 837.617419,440.410882 836.690206,440.280953 L836.690206,440.280953 Z M840.332,437.984 L838.253617,437.984585 L838.253416,438.268298 C838.253416,438.513964 838.203014,438.756223 838.106526,438.980139 C838.959136,439.229905 839.701853,439.616403 840.332941,440.102922 L840.332,437.984 Z M836.469162,430.256336 L830.303396,434.261998 L836.469162,438.26766 L836.470631,436.191415 L848.215762,436.191856 L848.215762,432.33214 L836.470632,432.331765 L836.469162,430.256336 Z M818.029146,430.586207 C819.014563,430.586207 819.813401,431.389007 819.813401,432.37931 C819.813401,433.369614 819.014563,434.172414 818.029146,434.172414 C817.495948,434.172414 817.017376,433.937372 816.690423,433.564763 C816.364534,433.937372 815.885962,434.172414 815.352764,434.172414 C814.367347,434.172414 813.568509,433.369614 813.568509,432.37931 C813.568509,431.389007 814.367347,430.586207 815.352764,430.586207 C815.885962,430.586207 816.364534,430.821249 816.691487,431.193857 C817.017376,430.821249 817.495948,430.586207 818.029146,430.586207 Z M839.440202,428.793103 L837.500248,428.792768 C837.955996,429.117625 838.253416,429.652075 838.253416,430.256336 L838.253416,430.256336 L838.253617,430.538718 L840.332,430.538 L840.332329,429.689655 C840.332329,429.194503 839.93291,428.793103 839.440202,428.793103 Z" 
      strokeLinecap="round"
      strokeLinejoin="round"
    />
    </g>
    </g>
  </g>
</svg>
}